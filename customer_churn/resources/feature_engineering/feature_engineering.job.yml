resources:
  jobs:
    data_preparation:
      name: Feature Engineering - Customer Churn ML Model
      tasks:
        - task_key: requirements
          notebook_task:
            notebook_path: ../../feature_engineering/notebooks/requirements.py
            source: WORKSPACE
          job_cluster_key: training_cluster
        - task_key: data_preparation
          depends_on:
            - task_key: requirements
          notebook_task:
            notebook_path: ../../feature_engineering/notebooks/data_preparation.py
            source: WORKSPACE
          job_cluster_key: training_cluster
      job_clusters:
        - job_cluster_key: training_cluster
          new_cluster:
            spark_version: 15.4.x-scala2.12
            aws_attributes:
              availability: ON_DEMAND
            node_type_id: rd-fleet.xlarge
            spark_env_vars:
              PYSPARK_PYTHON: /databricks/python3/bin/python3
            data_security_mode: DATA_SECURITY_MODE_DEDICATED
            runtime_engine: PHOTON
            kind: CLASSIC_PREVIEW
            use_ml_runtime: true
            is_single_node: false
            autoscale:
              min_workers: 2
              max_workers: 8
      queue:
        enabled: true
      parameters:
        - name: bronze_table_name
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_bronze_customers
        - name: inference_table_name
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_inference_table
        - name: input_table_name
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_bronze_customers
        - name: advanced_churn_label_table
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_label_table
        - name: advanced_churn_feature_table
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_feature_table
        - name: avg_price_increase
          default: ${var.catalog_use}.${var.schema_use}.advanced_churn_feature_table
